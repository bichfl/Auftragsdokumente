<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auftragsdokumente App</title>
  <style>
	:root {
	  --button-color: #9b9b9b;
	  --button-hover: #696969;
	  --button-text: #ffffff;
	}
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .layout {
      padding: 10px;
    }
    .input-container {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    input[type="text"], select {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 4px;
    }
    #mobile-layout input[type="text"] { width: 110px; }
    #desktop-layout input[type="text"] { width: 200px; }
    button {
      background-color: var(--button-color);
      color: var(--button-text);
      border: none;
      cursor: pointer;
      border-radius: 4px;
      text-align: left;
      padding-left: 16px;
      transition-duration: 0.3s;
      width: 100%;
    }
    button:hover {
	  background-color: var(--button-hover);
	}
    body.mobile button, body.desktop button {
      padding: 4.5px 16px;
      font-size: 16px;
      margin-bottom: 5px;
    }
    .button-scroll-container {
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      padding-bottom: 150px;
      box-sizing: border-box;
    }
    body.mobile .button-scroll-container { height: calc(100vh - 220px); }
    body.desktop .button-scroll-container { height: calc(100vh - 150px); }
    .header-container span {
      display: block;
      text-align: left;
      font-weight: bold;
      margin-bottom: 5px;
    }
    /* rechter Buttonbereich */
    .bottom-right-info {
      position: fixed;
      bottom: 10px;
      right: 10px;
      text-align: right;
      z-index: 1000;
    }
    .bottom-right-info button {
      width: auto;
      white-space: nowrap;
    }
    .bottom-right-info .version {
      font-size: 14px;
      color: #555;
      margin-top: 4px;
    }
    /* neuer linker Buttonbereich */
    .bottom-left-info {
      position: fixed;
      bottom: 10px;
      left: 10px;
      text-align: left;
      z-index: 1000;
    }
    .bottom-left-info button {
      width: auto;
      white-space: nowrap;
    }

    .overlay {
      position: fixed;
      bottom: 70px;
      right: 10px;
      background-color: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1001;
      display: none;
      opacity: 0;
      transition: opacity 0.4s ease;
      width: auto;
      min-width: 300px;
      max-width: 90vw;
      max-height: 80vh;
      flex-direction: column;
      height: calc(80vh - 90px);
    }
    .overlay.show { display: flex; opacity: 1; }
    .overlay.hide { opacity: 0; }
    .overlay-header {
      position: sticky;
      top: 0;
      background-color: #f9f9f9;
      padding: 0px 20px 10px 20px;
      border-radius: 10px;
      z-index: 2;
    }
    .overlay-header-top { height: 20px; }
    .overlay .input-container input[type="text"] {
      width: 100%;
      box-sizing: border-box;
    }
    .overlay-scroll {
      overflow-y: auto;
      padding: 0px 20px 20px 20px;
      height: calc(100% - 90px);
      box-sizing: border-box;
    }
    .overlay-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .overlay-buttons button {
      white-space: normal;
      word-break: break-word;
      width: 100%;
    }
    #anschlussplaene-overlay {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      border: 2px solid #333;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      z-index: 2000;
      display: none;
      width: 350px;
      max-width: 90vw;
      padding: 20px;
      flex-direction: column;
      max-height: 80vh;
      overflow-y: auto;
    }
    #anschlussplaene-overlay.show { display: flex; }
    #anschlussplaene-overlay h3 { margin-top: 0; }
    #anschlussplaene-overlay .search-container {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      margin-bottom: 15px;
    }
    #anschlussplaene-overlay input[type="text"] {
      flex-grow: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    #anschlussplaene-overlay button.search-btn {
      padding: 8px 16px;
      background-color: var(--button-color);
      color: var(--button-text);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    #anschlussplaene-overlay button.search-btn:hover { background-color: var(--button-hover); }
    #anschlussplaene-overlay button.close-btn {
      margin-top: 10px;
      align-self: flex-end;
      background-color: var(--button-color);
      color: var(--button-text);
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #anschlussplaene-overlay button.close-btn:hover { background-color: var(--button-hover); }
	#readme-popup {
      position: fixed;
      bottom: 110px;
      right: 10px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 2000;
      display: none;
      max-width: 90vw;
      max-height: 70vh;
      overflow: auto;
      padding: 16px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .version.clickable {
      cursor: pointer;
      color: #555;
      text-decoration: none;
    }
    .version.clickable:hover {
      color: #000;
    }
    #readme-popup h2 {
      margin-top: 0;
      font-family: Arial, sans-serif;
      font-size: 18px;
      font-weight: bold;
    }
	#settings-overlay {
	  position: fixed;
	  bottom: 60px;
	  left: 10px;
	  background-color: #fff;
	  border: 1px solid #ccc;
	  border-radius: 10px;
	  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
	  z-index: 1500;
	  display: none;
	  padding: 16px;
	  min-width: 250px;
	  max-width: 80vw;
	}
	#settings-overlay.show { display: block; }

  </style>
</head>
<body>
  <div id="mobile-layout" class="layout" style="display: none;">
    <div class="header-container"><span>Auftragsdokumente mobile App</span></div>
    <div class="input-container">
      <input type="text" id="mobileInputField" placeholder="lfd.Nr. eingeben" />
      <select id="mobileProfileSelector" onchange="loadMobileProfileButtons()"></select>
    </div>
    <div class="button-scroll-container" id="mobileButtonContainer"></div>
  </div>
  <div id="desktop-layout" class="layout" style="display: none;">
    <div class="header-container"><span>Auftragsdokumente Desktop-App</span></div>
    <div class="input-container">
      <input type="text" id="desktopInputField" placeholder="lfd.Nr. hier eingeben" />
      <select id="desktopProfileSelector" onchange="loadDesktopProfileButtons()"></select>
    </div>
    <div class="button-scroll-container" id="desktopButtonContainer"></div>
  </div>

  <!-- NEUER LINKSBÜNDIGER BUTTON -->
  <div class="bottom-left-info">
    <button onclick="toggleSettings()">⛭</button>
  </div>

  <!-- Einstellungen-Overlay -->
  <div id="settings-overlay">
  <div class="settings-content">
    <h3>Einstellungen</h3>

    <label for="btnColorPicker">Buttonfarbe:</label><br>
    <input type="color" id="btnColorPicker" value="#9b9b9b"><br><br>

    <label for="btnHoverColorPicker">Hoverfarbe:</label><br>
    <input type="color" id="btnHoverColorPicker" value="#696969"><br><br>

    <label for="btnTextColorPicker">Schriftfarbe:</label><br>
    <input type="color" id="btnTextColorPicker" value="#ffffff"><br><br>

    <button id="resetDefaultsBtn">Standard wiederherstellen</button>
  </div>
</div>

  <div class="bottom-right-info">
	<button onclick="toggleOverlay()">fehlendes Dokument anfordern</button>
    <div class="version clickable" onclick="toggleReadmePopup()">Programmversion 3.2.6</div>
  </div>

  <div class="overlay" id="overlay">
    <div class="overlay-header"><div class="overlay-header-top"></div>
      <div class="input-container"><input type="text" id="posInputField" placeholder="Pos.Nr. eingeben" /></div>
    </div>
    <div class="overlay-scroll"><div class="overlay-buttons"></div></div>
  </div>
  <div id="anschlussplaene-overlay">
    <h3>Anschlusspläne</h3>
    <div class="search-container">
      <input type="text" id="anschlussSuche" placeholder="Artikelnummer eingeben" />
      <button class="search-btn" onclick="suchAnschlussplaene()">Suchen</button>
    </div>
    <button class="close-btn" onclick="closeAnschlussplaeneOverlay()">Schließen</button>
  </div>

  <div id="readme-popup"></div>

  <script>

	function applyButtonStyles(normal, hover, text) {
  if (normal) document.documentElement.style.setProperty('--button-color', normal);
  if (hover)  document.documentElement.style.setProperty('--button-hover', hover);
  if (text)   document.documentElement.style.setProperty('--button-text', text);
}

function toggleSettings() {
  const s = document.getElementById("settings-overlay");
  s.classList.toggle("show");
}

// Klick außerhalb schließt das Overlay
document.addEventListener("click", function(e) {
  const s = document.getElementById("settings-overlay");
  const btn = document.querySelector(".bottom-left-info button");
  if (s.classList.contains("show") && !s.contains(e.target) && !btn.contains(e.target)) {
    s.classList.remove("show");
  }
});

document.addEventListener("DOMContentLoaded", () => {
  const colorPickers = {
    btnColorPicker: "buttonColor",
    btnHoverColorPicker: "buttonHoverColor",
    btnTextColorPicker: "buttonTextColor"
  };

  // gespeicherte Werte laden oder Defaults
  const normal = localStorage.getItem("buttonColor") || "#9b9b9b";
  const hover  = localStorage.getItem("buttonHoverColor") || "#696969";
  const text   = localStorage.getItem("buttonTextColor") || "#ffffff";

  document.getElementById("btnColorPicker").value = normal;
  document.getElementById("btnHoverColorPicker").value = hover;
  document.getElementById("btnTextColorPicker").value = text;

  applyButtonStyles(normal, hover, text);

  // Änderungen speichern & anwenden
  Object.entries(colorPickers).forEach(([pickerId, storageKey]) => {
    const picker = document.getElementById(pickerId);
    picker.addEventListener("input", () => {
      const value = picker.value;
      localStorage.setItem(storageKey, value);

      const newNormal = document.getElementById("btnColorPicker").value;
      const newHover  = document.getElementById("btnHoverColorPicker").value;
      const newText   = document.getElementById("btnTextColorPicker").value;

      applyButtonStyles(newNormal, newHover, newText);
    });
  });

  // 👉 Hier fehlt bisher der Reset!
  document.getElementById("resetDefaultsBtn").addEventListener("click", () => {
    // Standardwerte zurücksetzen
    const defaults = {
      buttonColor: "#9b9b9b",
      buttonHoverColor: "#696969",
      buttonTextColor: "#ffffff"
    };

    // localStorage leeren/überschreiben
    Object.entries(defaults).forEach(([key, val]) => {
      localStorage.setItem(key, val);
    });

    // Inputs zurücksetzen
    document.getElementById("btnColorPicker").value = defaults.buttonColor;
    document.getElementById("btnHoverColorPicker").value = defaults.buttonHoverColor;
    document.getElementById("btnTextColorPicker").value = defaults.buttonTextColor;

    // Styles anwenden
    applyButtonStyles(
      defaults.buttonColor,
      defaults.buttonHoverColor,
      defaults.buttonTextColor
    );
  });
});



	async function toggleReadmePopup() {
      const popup = document.getElementById('readme-popup');
	  popup.style.color = '#000';
      if (popup.style.display === 'block') {
        popup.style.display = 'none';
        return;
      }
      try {
        popup.innerHTML = '<h2>CHANGELOG</h2><div>Lade...</div>';
        popup.style.display = 'block';

        // Zeitstempel anhängen, damit der Browser nicht cached
        const url = 'https://bichfl.github.io/Auftragsdokumente/README.md?t=' + Date.now();

        const res = await fetch(url);
        if (!res.ok) throw new Error('Fehler beim Laden der README.md');
        const text = await res.text();

        // Inhalt einfügen (HTML-Tags entschärfen)
        popup.innerHTML = '<h2>CHANGELOG</h2><div>' + text.replace(/</g, "&lt;") + '</div>';
      } catch (err) {
        popup.innerHTML = '<h2>CHANGELOG</h2><div>Fehler beim Laden: ' + err.message + '</div>';
      }
    }

    // Klick außerhalb schließt das Popup
    document.addEventListener('click', function(event) {
      const popup = document.getElementById('readme-popup');
      const version = document.querySelector('.version.clickable');
      if (popup.style.display === 'block' && !popup.contains(event.target) && !version.contains(event.target)) {
        popup.style.display = 'none';
      }
    });
	
	async function fetchJsonMitFallback(u1, u2) {
      try {
        const r1 = await fetch(u1);
        if (r1.ok) return await r1.json();
        const r2 = await fetch(u2);
        if (r2.ok) return await r2.json();
        throw new Error('Nicht gefunden');
      } catch (err) {
        throw err;
      }
    }
    let profiles = {};
    async function loadProfiles() {
	  try {
		profiles = await fetchJsonMitFallback(
		  `https://bichfl.github.io/Auftragsdokumente/profile.json?t=${Date.now()}`,
		  `https://bichfl.github.io/Auftragsdokumente/profile.JSON?t=${Date.now()}`
		);
		populateProfileSelectors();
		initUI();
	  } catch (e) {
		console.error(e);
		alert('Profile konnten nicht geladen werden.');
	  }
	}
    function populateProfileSelectors() {
      ['mobileProfileSelector', 'desktopProfileSelector'].forEach(id => {
        const sel = document.getElementById(id);
        sel.innerHTML = '';
        Object.entries(profiles).forEach(([key, prof]) => {
          const opt = document.createElement('option');
          opt.value = key;
          opt.textContent = prof.displayName;
          sel.appendChild(opt);
        });
      });
    }
    function initUI() {
      if (istMobil()) {
        document.body.classList.add('mobile');
        document.getElementById('mobile-layout').style.display = 'block';
        const sel = document.getElementById('mobileProfileSelector');
        sel.value = localStorage.getItem('selectedMobileProfile') || sel.options[0].value;
        loadMobileProfileButtons();
      } else {
        document.body.classList.add('desktop');
        document.getElementById('desktop-layout').style.display = 'block';
        const sel = document.getElementById('desktopProfileSelector');
        sel.value = localStorage.getItem('selectedDesktopProfile') || sel.options[0].value;
        loadDesktopProfileButtons();
      }
    }
    function loadProfileButtons(profileKey, inputId, containerId, isDesktop) {
      localStorage.setItem(isDesktop ? 'selectedDesktopProfile' : 'selectedMobileProfile', profileKey);
      const prof = profiles[profileKey];
      const cont = document.getElementById(containerId);
      cont.innerHTML = '';
      prof.buttons.forEach(name => {
        const btn = document.createElement('button');
        btn.textContent = name;
        btn.onclick = () => {
          if (isDesktop && name === 'Anschlusspläne') return toggleAnschlussplaeneOverlay(true);
          const input = document.getElementById(inputId).value.trim();
          let url = name === 'Fließfertigung' ? getFliessfertigungUrl(profileKey)
            : `https://peneder.sharepoint.com/:b:/r/sites/FSF-AluAuftragsdokumente/Freigegebene%20Dokumente/${input}_${name}.pdf?csf=1&web=1`;
          if (url) window.open(url, '_blank');
        };
        cont.appendChild(btn);
      });
    }
    function loadMobileProfileButtons() {
      loadProfileButtons(document.getElementById('mobileProfileSelector').value,
        'mobileInputField', 'mobileButtonContainer', false);
    }
    function loadDesktopProfileButtons() {
      loadProfileButtons(document.getElementById('desktopProfileSelector').value,
        'desktopInputField', 'desktopButtonContainer', true);
    }
    async function suchAnschlussplaene() {
      const nr = document.getElementById('anschlussSuche').value.trim();
      if (!nr) return alert('Bitte eine Artikelnummer eingeben.');
      const t = Date.now();
      try {
        const daten = await fetchJsonMitFallback(
          `https://bichfl.github.io/Auftragsdokumente/PIN-Belegung.json?t=${t}`,
          `https://bichfl.github.io/Auftragsdokumente/PIN-Belegung.JSON?t=${t}`
        );
        const ein = daten.find(d => d.ArtNR === nr);
        if (!ein) return alert('Artikelnummer nicht gefunden.');
        const pdfUrl = `https://peneder.sharepoint.com/:b:/r//sites/FSF-AluAuftragsdokumente/Freigegebene%20Dokumente/PIN-Belegung/${ein.Pfad}/${encodeURIComponent(ein.Dokument)}.pdf#zoom=500`;
        window.open(pdfUrl,'_blank');
      } catch(e){ alert(e.message); }
    }
    function toggleOverlay() {
      const o = document.getElementById('overlay');
      if (!o.classList.contains('show')) {
        populateOverlayButtons();
        o.style.display='flex';
        o.classList.add('show');
        o.classList.remove('hide');
      } else {
        o.classList.add('hide');
        o.classList.remove('show');
        setTimeout(()=>o.style.display='none',400);
      }
    }
    function populateOverlayButtons() {
      const con = document.querySelector('.overlay-buttons');
      con.innerHTML='';
      const isMob = document.body.classList.contains('mobile');
      const sel = document.getElementById(isMob ? 'mobileProfileSelector' : 'desktopProfileSelector');
      profiles[sel.value].buttons.forEach(name => {
        const b = document.createElement('button');
        b.textContent = name;
        b.onclick = () => openAccessMail(name);
        con.appendChild(b);
      });
    }
    function openAccessMail(btnName) {
      const nr = getLaufendeNummer();
      const pos = document.getElementById('posInputField').value.trim();
      const subj = encodeURIComponent('fehlende Dokumente zu ' + nr);
      const body = encodeURIComponent(
        pos
          ? `Zur laufenden Nummer "${nr}", Position "${pos}" fehlt folgendes Dokument:\n\n"${btnName}"\n\nBitte legt das Dokument ab.`
          : `Zur laufenden Nummer "${nr}" fehlt folgendes Dokument:\n\n"${btnName}"\n\nBitte legt das Dokument ab.`
      );
      window.open(`https://access.peneder.com/owa/?path=/mail/action/compose&to=ok.alu@peneder.com&subject=${subj}&body=${body}`, '_blank');
    }
    function getLaufendeNummer() {
      const mi = document.getElementById('mobileInputField');
      return mi.offsetParent !== null ? mi.value : document.getElementById('desktopInputField').value;
    }
    function istMobil() {
      const ua = navigator.userAgent;
      const mobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
      const touch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      const small = window.innerWidth <= 768;
      return [mobileUA, touch, small].filter(Boolean).length >= 2;
    }
    function getFormattedDate() {
      const d = new Date();
      return `${String(d.getDate()).padStart(2,'0')}.${String(d.getMonth()+1).padStart(2,'0')}.${d.getFullYear()}`;
    }
    function getFliessfertigungUrl(profile) {
      const date = getFormattedDate();
      const base = 'https://peneder.sharepoint.com/:b:/r/sites/FSF-AluAuftragsdokumente/Freigegebene%20Dokumente/Fließfertigung/';
      switch(profile) {
        case 'profile2': return `${base}Lager/${date}.pdf?csf=1&web=1`;
        case 'profile3': return `${base}Stabbearbeitung/${date}.pdf?csf=1&web=1`;
        case 'profile4': return `${base}Stabbearbeitung/${date}.pdf?csf=1&web=1`;
        case 'profile5': return `${base}Türstabmontage/${date}.pdf?csf=1&web=1`;
        case 'profile6': return `${base}Verklebung/${date}.pdf?csf=1&web=1`;
        case 'profile7': return `${base}Zusammenbau/${date}.pdf?csf=1&web=1`;
        case 'profile8': return `${base}Verglasung/${date}.pdf?csf=1&web=1`;
        case 'profile9': return `${base}Sonder/${date}.pdf?csf=1&web=1`;
        default: return null;
      }
    }
    function toggleAnschlussplaeneOverlay(show) {
      const o = document.getElementById('anschlussplaene-overlay');
      if (show) { o.style.display='flex'; o.classList.add('show'); }
      else { o.classList.remove('show'); o.style.display='none'; }
    }
    function closeAnschlussplaeneOverlay() {
      toggleAnschlussplaeneOverlay(false);
    }
    document.addEventListener('click', event => {
      const o = document.getElementById('overlay'), btn = document.querySelector('.bottom-right-info button');
      if (o.classList.contains('show') && !o.contains(event.target) && !btn.contains(event.target)) toggleOverlay();
    });
    document.addEventListener('click', event => {
      const o = document.getElementById('anschlussplaene-overlay');
      const dBtn = Array.from(document.querySelectorAll('#desktopButtonContainer button')).find(b => b.textContent==='Anschlusspläne');
      if (o.classList.contains('show') && !o.contains(event.target) && (!dBtn||!dBtn.contains(event.target))) toggleAnschlussplaeneOverlay(false);
    });
    document.addEventListener('DOMContentLoaded', loadProfiles);
	
	let changelogClickCount = 0;
  let clickTimeout;

  document.addEventListener("click", function(e) {
    if (e.target.closest("#readme-popup h2")) {
      changelogClickCount++;
      clearTimeout(clickTimeout);
      clickTimeout = setTimeout(() => { changelogClickCount = 0; }, 2000);

      if (changelogClickCount >= 8) {
        showEasterEgg();
        changelogClickCount = 0;
      }
    } else if (!e.target.closest("#readme-popup")) {
      changelogClickCount = 0;
    }
  });

  function showEasterEgg() {
  const popup = document.getElementById('readme-popup');

  // Hintergrundfarbe merken
  const popupBackground = window.getComputedStyle(popup).backgroundColor;

  // Größe & Stil anpassen, Position bleibt
  popup.style.width = '800px';
  popup.style.height = 'auto';
  popup.style.maxWidth = 'none';

  // Spielfeld HTML einfügen
  popup.innerHTML = `
    <style>
      * { box-sizing: border-box; }

      #game {
        position: relative;
        width: 650px;
        height: 200px;
        border: 3px solid var(--button-color); /* optional: Rahmen auch grau */
        overflow: hidden;
        background: ${popupBackground};
        margin: 10px auto;
      }

      #player {
        position: absolute;
        width: 40px;
        height: 40px;
        background: var(--button-color); /* grau wie Buttons */
        bottom: 0;
        left: 50px;
        transition: bottom 0.3s, height 0.1s;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      #player .logo { width: 16px; height: 16px; }

      .obstacle {
        position: absolute;
        right: -30px;
        animation-name: moveLeft;
        animation-timing-function: linear;
        animation-fill-mode: forwards;
        background: var(--button-color); /* grau wie Buttons */
      }

      @keyframes moveLeft {
        from { right: -30px; }
        to { right: 100%; }
      }

      /* --- Wichtig: höhere Spezifität, damit globale Button-Regeln NICHT gewinnen --- */
      #readme-popup .controls {
        margin-top: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px;
        text-align: center;
        flex-wrap: nowrap;
      }

      #readme-popup .controls button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: auto !important;         /* globale width:100% überstimmen */
        padding: 20px 30px !important;  /* höher/breiter */
        font-size: 28px !important;     /* größere Pfeile */
        line-height: 1;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        background-color: var(--button-color);
        color: var(--button-text);
        transition: background-color 0.3s;
      }

      #readme-popup .controls button:hover {
        background-color: var(--button-hover);
      }

      #score {
        margin-top: 10px;
        font-size: 18px;
        text-align: center;
        color: black;
      }
    </style>

    <div id="game">
      <div id="player">
        <img src="https://www.peneder.com/assets/favicons/favicon-16x16.png" alt="Logo" class="logo">
      </div>
    </div>

    <div class="controls">
      <button onclick="jump()">↑</button>
      <button onclick="duck()">↓</button>
    </div>

    <div id="score">Punkte: 0</div>
  `;

  popup.style.display = 'block';

  // Spiellogik starten
  initGame();
}



function initGame() {
  const player = document.getElementById("player");
  const game = document.getElementById("game");
  const scoreDisplay = document.getElementById("score");

  let isJumping = false;
  let isDucking = false;
  let score = 0;

  window.jump = function() {
    if (isJumping || isDucking) return;
    isJumping = true;
    player.style.bottom = "100px";
    setTimeout(() => {
      player.style.bottom = "0";
      setTimeout(() => { isJumping = false; }, 300);
    }, 300);
  };

  window.duck = function() {
    if (isJumping || isDucking) return;
    isDucking = true;
    player.style.height = "20px";
    player.style.alignItems = "flex-end";
    setTimeout(() => {
      player.style.height = "40px";
      player.style.alignItems = "center";
      isDucking = false;
    }, 500);
  };

  function getSpeed() {
    const baseDuration = 3.0;
    const minDuration = 1.2;
    const speedUp = Math.min(score * 0.05, baseDuration - minDuration);
    return (baseDuration - speedUp).toFixed(2) + 's';
  }

  function spawnObstacle() {
    const obs = document.createElement("div");
    obs.classList.add("obstacle");

    const isHigh = Math.random() < 0.5;
    if (isHigh) {
      obs.style.height = "30px";
      obs.style.width = "30px";
      obs.style.bottom = "25px";
      obs.style.background = "var(--button-color)";
    } else {
      obs.style.height = "30px";
      obs.style.width = "20px";
      obs.style.bottom = "0";
      obs.style.background = "var(--button-color)";
    }

    obs.style.animationDuration = getSpeed();
    game.appendChild(obs);

    const obsInterval = setInterval(() => {
      const obsRect = obs.getBoundingClientRect();
      const playerRect = player.getBoundingClientRect();

      const verticalOverlap = playerRect.bottom > obsRect.top && playerRect.top < obsRect.bottom;
      const horizontalOverlap = obsRect.left < playerRect.right && obsRect.right > playerRect.left;

      if (horizontalOverlap && verticalOverlap) {
        alert("Game Over! Dein Punktestand: " + score);
        location.reload();
      }
    }, 20);

    obs.addEventListener("animationend", () => {
      clearInterval(obsInterval);
      obs.remove();
      score++;
      scoreDisplay.textContent = "Punkte: " + score;
    });
  }

  function startObstacleLoop() {
    const minDelay = 2000;
    const maxDelay = 3500;
    function loop() {
      spawnObstacle();
      const nextDelay = Math.random() * (maxDelay - minDelay) + minDelay;
      setTimeout(loop, nextDelay);
    }
    loop();
  }

  document.addEventListener("keydown", (e) => {
    if (e.code === "ArrowUp") jump();
    if (e.code === "ArrowDown") duck();
  });

  startObstacleLoop();
}

  </script>
</body>
</html>
